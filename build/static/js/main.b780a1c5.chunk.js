(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{208:function(e,t,s){e.exports=s(454)},415:function(e,t,s){},442:function(e,t){},449:function(e,t,s){},450:function(e,t,s){},451:function(e,t,s){},452:function(e,t,s){},453:function(e,t,s){},454:function(e,t,s){"use strict";s.r(t);s(209),s(219);var n=s(1),i=s.n(n),a=s(96),r=s.n(a);s(415),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l=s(32),c=s(18),o=s(98),u=s.n(o),p=30,d=Object(c.b)("USER_VERIFY"),h=Object(c.b)("USER_EXIST"),g=Object(c.b)("USER_CONNECTED"),m=(Object(c.b)("USER_DISCONNECTED"),Object(c.b)("USER_LIST_CHANGE")),E=Object(c.b)("MESSAGE_NEW"),b=Object(c.b)("MESSAGE_SEND"),f=Object(c.b)("MESSAGE_HISTORY"),S=Object(c.b)("MESSAGE_SHIFT"),v=Object(c.b)("LIVE_MODE_TOGGLE"),O=s(99),M=s(36),j={user:null,userExist:!1,userList:[],messages:[],visibleMessages:[],allLoaded:!1,isLiveMode:!0,indexVisibleMessageId:null},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0,s=t.payload,n=Object(l.a)(e.visibleMessages),i=e.indexVisibleMessageId;switch(t.type){case"USER_EXIST":return Object(M.a)({},e,{userExist:!0});case"USER_CONNECTED":return Object(M.a)({},e,{user:s});case"USER_DISCONNECTED":return Object(M.a)({},e,{user:null});case"USER_LIST_CHANGE":return Object(M.a)({},e,{userList:s});case"MESSAGE_NEW":var a=[].concat(Object(l.a)(e.messages),[s]);return e.isLiveMode&&(n=[].concat(Object(l.a)(e.visibleMessages),[s]).slice(-600),i=e.indexVisibleMessageId+1-n.length+e.visibleMessages.length),Object(M.a)({},e,{messages:a,indexVisibleMessageId:i,visibleMessages:n});case"MESSAGE_HISTORY":return n=[].concat(Object(l.a)(s),Object(l.a)(e.visibleMessages)).slice(-600),i=e.indexVisibleMessageId+s.length-n.length+e.visibleMessages.length,Object(M.a)({},e,{allLoaded:s.length<330,messages:[].concat(Object(l.a)(s),Object(l.a)(e.messages)),visibleMessages:n,indexVisibleMessageId:i});case"MESSAGE_SHIFT":return i=s>0?Math.min(e.indexVisibleMessageId+s,e.messages.length-600):Math.max(0,e.indexVisibleMessageId+s),Object(M.a)({},e,{visibleMessages:e.messages.slice(i,i+600),indexVisibleMessageId:i});case"LIVE_MODE_TOGGLE":return Object(M.a)({},e,{isLiveMode:s});default:return e}},N=function(e){var t=u.a.connect(e,{pingInterval:3e3,pingTimeout:1e4,transports:["websocket","polling"]}),s=!1;return function(e){var n=e.getState,i=e.dispatch;return function(e){return function(a){switch(a.type){case"USER_VERIFY":return t.emit("USER_VERIFY",a.payload,function(e){var n=e.user;e.isUser?i(h()):(i(g(n)),t.on("USER_CONNECTED",function(e){i(m(e.connectedUsers))}),t.on("USER_DISCONNECTED",function(e){i(m(e.connectedUsers))}),t.on("MESSAGE_SEND",function(e){i(E(e))}),t.on("MESSAGE_HISTORY",function(e){s=!1,i(f(e))}),t.emit("USER_CONNECTED",{user:n,historyLimit:600}))}),!1;case"MESSAGE_SEND":return t.emit("MESSAGE_SEND",a.payload),!1;case"MESSAGE_SHIFT":return!s&&!n().allLoaded&&n().indexVisibleMessageId<5*p&&(s=!0,t.emit("MESSAGE_HISTORY",330)),e(a);default:return e(a)}}}}}("https://chat-server-pavel.herokuapp.com"),I=[].concat(Object(l.a)(Object(c.c)()),[O.a,N]),C=Object(c.a)({reducer:T,middleware:I,devTools:!1}),_=s(31),R=s(42),w=s(43),x=s(46),L=s(44),D=s(45),k=s(61),y=(s(449),function(e){function t(e){var s;return Object(R.a)(this,t),(s=Object(x.a)(this,Object(L.a)(t).call(this,e))).handleSubmit=function(e){var t=s.input.current.value;e.preventDefault(),""!==t&&s.props.setUser(t)},s.input=i.a.createRef(),s.handleSubmit=s.handleSubmit.bind(Object(k.a)(s)),s}return Object(D.a)(t,e),Object(w.a)(t,[{key:"componentDidMount",value:function(){this.input.current.focus()}},{key:"render",value:function(){return i.a.createElement("div",{className:"login"},i.a.createElement("h3",null,"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0412\u0430\u0448\u0435 \u0438\u043c\u044f"),i.a.createElement("form",{className:"login-form",onSubmit:this.handleSubmit},i.a.createElement("label",{htmlFor:"nickname"},"\u041d\u0438\u043a"),i.a.createElement("input",{ref:this.input,id:"nickname",type:"text",placeholder:"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0412\u0430\u0448 \u041d\u0438\u043a"}),i.a.createElement("div",{className:"error"},this.props.userExist?"\u0412 \u0447\u0430\u0442\u0435 \u0435\u0441\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0442\u0430\u043a\u0438\u043c \u041d\u0438\u043a\u043e\u043c":null),i.a.createElement("input",{type:"submit",value:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c"})))}}]),t}(i.a.Component)),U=Object(_.b)(function(){return{userExist:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).userExist}},function(e){return{setUser:function(t){return e(d(t))}}})(y),G=(s(450),s(451),function(e){var t=e.data,s=t.dt,i=t.user,a=t.message;return n.createElement("li",{className:"message",id:e.id},n.createElement("span",{className:"date"},"[",new Date(s).toLocaleString(),"] "),n.createElement("span",{className:"nick"},i,": "),n.createElement("span",{className:"text"},a))}),H=function(e){return e.messages.length>0&&e.visibleMessages.length>0&&e.messages[e.messages.length-1].id===e.visibleMessages[e.visibleMessages.length-1].id},V=function(e){return e.allLoaded&&0===e.indexVisibleMessageId},A=15,B=function(e){function t(e){var s;return Object(R.a)(this,t),(s=Object(x.a)(this,Object(L.a)(t).call(this,e))).handleSubmit=function(e){var t=s.props,n=t.user,i=t.messageSend,a=s.textInput.current.value;e.preventDefault(),""!==a&&(i(n,a),s.textInput.current.value="")},s.handleScroll=function(e){var t=e.currentTarget,n=t.scrollTop,i=t.scrollHeight,a=t.clientHeight,r=Math.round(i*A/100);if(s.prevScrollTop!==n){var l=s.wrapper.current.getBoundingClientRect().bottom,c=s.wrapper.current.firstChild.lastChild.getBoundingClientRect().bottom<=l;s.prevScrollTop>n&&(s.props.isLiveMode&&!c&&s.props.liveModeToggle(!1),n<r&&!s.isShifting&&!s.props.reachedBegin&&(s.isShifting=!0,s.props.messageShift(-p))),s.prevScrollTop<n&&(!s.props.isLiveMode&&c&&s.props.liveModeToggle(!0),i-a-n<r&&!s.isShifting&&(s.isShifting=!0,s.props.messageShift(p))),s.prevScrollTop=n}},s.getMessageId=function(e){return"message"+e},s.textInput=i.a.createRef(),s.wrapper=i.a.createRef(),s.handleScroll=s.handleScroll.bind(Object(k.a)(s)),s.isShifting=!1,s}return Object(D.a)(t,e),Object(w.a)(t,[{key:"componentDidMount",value:function(){this.wrapper.current.addEventListener("scroll",this.handleScroll,{passive:!0}),this.textInput.current.focus()}},{key:"componentWillUnmount",value:function(){this.wrapper.current.removeEventListener("scroll",this.handleScroll,{passive:!0})}},{key:"getSnapshotBeforeUpdate",value:function(e,t){return 0===e.messages.length||0===this.props.messages.length?null:{firstMessageTop:this.wrapper.current.firstChild.firstChild.getBoundingClientRect().top,lastMessageTop:this.wrapper.current.firstChild.lastChild.getBoundingClientRect().top,scrollTop:this.wrapper.current.scrollTop}}},{key:"componentDidUpdate",value:function(e,t,s){var n=this.wrapper.current;if(0===e.messages.length&&this.props.messages.length>0&&(n.scrollTop=n.scrollHeight-n.clientHeight,this.prevScrollTop=n.scrollTop),this.props.isLiveMode)n.scrollTop=n.scrollHeight-n.clientHeight;else if(null!==s&&s.scrollTop===n.scrollTop){var i=n.firstChild,a=0,r=e.messages[0].id,l=e.messages[e.messages.length-1].id;if(r>this.props.messages[0].id){for(a=r-this.props.messages[0].id;a>0&&i.childNodes[a].id!==this.getMessageId(r);)a--;if(i.childNodes[a].id===this.getMessageId(r)){var c=i.childNodes[a].getBoundingClientRect().top;n.scrollTop+=c-s.firstMessageTop}}else if(r<this.props.messages[0].id){for(a=this.props.messages.length-this.props.messages[this.props.messages.length-1].id+l-1;a<this.props.messages.length&&i.childNodes[a].id!==this.getMessageId(l);)a++;if(i.childNodes[a].id===this.getMessageId(l)){var o=i.childNodes[a].getBoundingClientRect().top;n.scrollTop+=o-s.lastMessageTop}}}this.isShifting&&(0!==n.scrollTop||this.props.reachedBegin?n.scrollTop+n.scrollHeight!==n.clientHeight||this.props.reachedEnd||this.props.messageShift(p):this.props.messageShift(-p)),this.isShifting=!1}},{key:"render",value:function(){var e=this,t=this.props.messages.map(function(t){return i.a.createElement(G,{data:t,key:t.id,id:e.getMessageId(t.id)})});return i.a.createElement("div",{className:"chat-room"},i.a.createElement("h3",null,"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0447\u0430\u0442\u0430"),i.a.createElement("div",{className:"wrapper",ref:this.wrapper,onWheel:this.handleScroll},i.a.createElement("ol",{className:"messages"},t)),i.a.createElement("div",{className:"sender"},i.a.createElement("form",{onSubmit:this.handleSubmit},i.a.createElement("input",{ref:this.textInput,type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"}),i.a.createElement("input",{type:"submit",value:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"}))))}}]),t}(n.Component),F=Object(_.b)(function(e){return{user:e.user,messages:e.visibleMessages,reachedBegin:V(e),reachedEnd:H(e),isLiveMode:e.isLiveMode}},function(e){return{messageSend:function(t,s){return e(b({user:t,text:s}))},messageShift:function(t){return e(S(t))},liveModeToggle:function(t){return e(v(t))}}})(B),Y=(s(452),function(e){function t(){return Object(R.a)(this,t),Object(x.a)(this,Object(L.a)(t).apply(this,arguments))}return Object(D.a)(t,e),Object(w.a)(t,[{key:"render",value:function(){var e=this.props.userList.map(function(e){return i.a.createElement("li",{key:e},e)});return i.a.createElement("div",{className:"user-list"},i.a.createElement("h3",null,"\u0421\u0435\u0439\u0447\u0430\u0441 \u0432 \u0447\u0430\u0442\u0435"),i.a.createElement("div",null,i.a.createElement("ul",null,e)))}}]),t}(n.Component)),W=Object(_.b)(function(e){return{userList:e.userList}})(Y),J=(s(453),"http://192.168.1.16:4000"),X=function(e){function t(e){var s;return Object(R.a)(this,t),(s=Object(x.a)(this,Object(L.a)(t).call(this,e))).initConnect=function(){var e=u()(J);e.on("connect",function(){console.log("connected")}),s.setState({socket:e})},s.login=function(e){s.state.socket.emit("USER_CONNECTED",e),s.setState({user:e})},s.logout=function(e){s.state.socket.emit("USER_DISCONNECTED",e),s.setState({user:null})},s.state={socket:null},s}return Object(D.a)(t,e),Object(w.a)(t,[{key:"render",value:function(){var e=this.props.user;return i.a.createElement("div",{className:"app"},e?i.a.createElement("div",{className:"chat"},i.a.createElement(W,null),i.a.createElement(F,null)):i.a.createElement(U,null))}}]),t}(n.Component),$=Object(_.b)(function(){return{user:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).user}})(X),q=document.getElementById("root");r.a.render(i.a.createElement(_.a,{store:C},i.a.createElement($,null)),q),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[208,1,2]]]);
//# sourceMappingURL=main.b780a1c5.chunk.js.map